<div class="page">
  <div class="card">
    <div class="brand">
      <div class="logo">BH</div>
      <div>
        <h1>Définir votre mot de passe</h1>
        <p class="subtitle">Activez votre compte Help Desk</p>
      </div>
    </div>

    <!-- ✅ loading -->
    <div *ngIf="loading" class="muted">Vérification du lien...</div>

    <div *ngIf="err" class="alert alert-danger">{{ err }}</div>
    <div *ngIf="msg" class="alert alert-success">{{ msg }}</div>

    <!-- ✅ Mode lien expiré -->
    <div *ngIf="!loading && linkExpired" class="expired-box">
      <h3>Lien expiré</h3>
      <p>Ce lien n’est plus valide. Vous pouvez contacter l’administrateur pour recevoir un nouveau lien.</p>

      <div class="field">
        <label>Email</label>
        <input class="input" [(ngModel)]="email" name="email" placeholder="ex: user@email.com" />
      </div>

      <button class="btn btn-primary" type="button"
              (click)="requestNewLink()"
              [disabled]="loading || sentRequest">
        {{ sentRequest ? 'Demande envoyée' : 'Contacter l’admin' }}
      </button>

      <div class="hint" *ngIf="sentRequest">
        L’admin a été informé. Attendez le nouveau lien.
      </div>

      <div class="footer">
        <a routerLink="/login">Retour à la connexion</a>
      </div>
    </div>

    <!-- ✅ Form normal (token OK) -->
    <form (ngSubmit)="submit()" class="form" *ngIf="!loading && !msg && !linkExpired">
      <div class="field">
        <label>Nouveau mot de passe</label>
        <input class="input"
               [(ngModel)]="newPassword"
               name="newPassword"
               type="password"
               required />
      </div>

      <div class="field">
        <label>Confirmer</label>
        <input class="input"
               [(ngModel)]="confirmPassword"
               name="confirmPassword"
               type="password"
               required />
      </div>

      <button class="btn btn-primary" type="submit" [disabled]="loading">
        {{ loading ? 'Validation...' : 'Valider' }}
      </button>

      <div class="hint">
        Vous serez redirigé vers la page de connexion après validation.
      </div>
    </form>

    <div class="footer" *ngIf="!loading">
      <a routerLink="/login">Retour à la connexion</a>
    </div>
  </div>
</div>
